From 66383e0daa25074a0ed2058ed7bdd5a0b1810514 Mon Sep 17 00:00:00 2001
From: chao zeng <chao.zeng@siemens.com>
Date: Tue, 15 Mar 2022 16:16:34 +0800
Subject: [PATCH 124/124] dts re structure

Signed-off-by: chao zeng <chao.zeng@siemens.com>
---
 .../dts/ti/k3-am65-iot2050-common-pg2-m2.dtsi | 33 -------------------
 .../dts/ti/k3-am65-iot2050-common-pg2.dtsi    | 23 ++++++++++++-
 .../k3-am654-iot2050-bkey-usb3-ekey-pcie.dts  |  5 +++
 .../dts/ti/k3-am6548-iot2050-advanced-m2.dts  | 20 ++++++++++-
 4 files changed, 46 insertions(+), 35 deletions(-)
 delete mode 100644 arch/arm64/boot/dts/ti/k3-am65-iot2050-common-pg2-m2.dtsi

diff --git a/arch/arm64/boot/dts/ti/k3-am65-iot2050-common-pg2-m2.dtsi b/arch/arm64/boot/dts/ti/k3-am65-iot2050-common-pg2-m2.dtsi
deleted file mode 100644
index 40ad18747d95..000000000000
--- a/arch/arm64/boot/dts/ti/k3-am65-iot2050-common-pg2-m2.dtsi
+++ /dev/null
@@ -1,33 +0,0 @@
-// SPDX-License-Identifier: GPL-2.0
-/*
- * Copyright (c) Siemens AG, 2021
- *
- * Authors:
- *   Chao Zeng <chao.zeng@siemens.com>
- *   Jan Kiszka <jan.kiszka@siemens.com>
- *
- * Common bits of the IOT2050 Basic and Advanced variants, PG2
- */
-
-&main_pmx0 {
-	cp2102n_reset_pin_default: cp2102n-reset-pin-default {
-		pinctrl-single,pins = <
-			/* (AF12) GPIO1_24, used as cp2102 reset */
-			AM65X_IOPAD(0x01e0, PIN_OUTPUT, 7)
-		>;
-	};
-};
-
-&main_gpio1 {
-	pinctrl-names = "default";
-	pinctrl-0 = <&cp2102n_reset_pin_default>;
-	gpio-line-names =
-		"", "", "", "", "", "", "", "", "", "",
-		"", "", "", "", "", "", "", "", "", "",
-		"", "", "", "", "CP2102N-RESET";
-};
-
-&dss {
-	/* Workaround needed to get DP clock of 154Mhz */
-	assigned-clocks = <&k3_clks 67 0>;
-};
\ No newline at end of file
diff --git a/arch/arm64/boot/dts/ti/k3-am65-iot2050-common-pg2.dtsi b/arch/arm64/boot/dts/ti/k3-am65-iot2050-common-pg2.dtsi
index 48f9242496cb..e73458ca6900 100644
--- a/arch/arm64/boot/dts/ti/k3-am65-iot2050-common-pg2.dtsi
+++ b/arch/arm64/boot/dts/ti/k3-am65-iot2050-common-pg2.dtsi
@@ -9,7 +9,28 @@
  * Common bits of the IOT2050 Basic and Advanced variants, PG2
  */
 
-#include "k3-am65-iot2050-common-pg2-m2.dtsi"
+&main_pmx0 {
+	cp2102n_reset_pin_default: cp2102n-reset-pin-default {
+		pinctrl-single,pins = <
+			/* (AF12) GPIO1_24, used as cp2102 reset */
+			AM65X_IOPAD(0x01e0, PIN_OUTPUT, 7)
+		>;
+	};
+};
+
+&main_gpio1 {
+	pinctrl-names = "default";
+	pinctrl-0 = <&cp2102n_reset_pin_default>;
+	gpio-line-names =
+		"", "", "", "", "", "", "", "", "", "",
+		"", "", "", "", "", "", "", "", "", "",
+		"", "", "", "", "CP2102N-RESET";
+};
+
+&dss {
+	/* Workaround needed to get DP clock of 154Mhz */
+	assigned-clocks = <&k3_clks 67 0>;
+};
 
 &serdes0 {
 	assigned-clocks = <&k3_clks 153 4>, <&serdes0 AM654_SERDES_CMU_REFCLK>;
diff --git a/arch/arm64/boot/dts/ti/k3-am654-iot2050-bkey-usb3-ekey-pcie.dts b/arch/arm64/boot/dts/ti/k3-am654-iot2050-bkey-usb3-ekey-pcie.dts
index 922a2eef4c55..b1da9d95fcb5 100644
--- a/arch/arm64/boot/dts/ti/k3-am654-iot2050-bkey-usb3-ekey-pcie.dts
+++ b/arch/arm64/boot/dts/ti/k3-am654-iot2050-bkey-usb3-ekey-pcie.dts
@@ -12,6 +12,11 @@
 #include <dt-bindings/phy/phy.h>
 #include <dt-bindings/phy/phy-am654-serdes.h>
 
+&serdes0 {
+	assigned-clocks = <&k3_clks 153 4>, <&serdes0 AM654_SERDES_CMU_REFCLK>;
+	assigned-clock-parents = <&k3_clks 153 7>, <&k3_clks 153 4>;
+};
+
 &pcie1_rc {
 	num-lanes = <1>;
 	phys = <&serdes1 PHY_TYPE_PCIE 0>;
diff --git a/arch/arm64/boot/dts/ti/k3-am6548-iot2050-advanced-m2.dts b/arch/arm64/boot/dts/ti/k3-am6548-iot2050-advanced-m2.dts
index 32cc989e88e6..52433d73c3ee 100644
--- a/arch/arm64/boot/dts/ti/k3-am6548-iot2050-advanced-m2.dts
+++ b/arch/arm64/boot/dts/ti/k3-am6548-iot2050-advanced-m2.dts
@@ -15,7 +15,7 @@
 /dts-v1/;
 
 #include "k3-am6548-iot2050-advanced-common.dtsi"
-#include "k3-am65-iot2050-common-pg2-m2.dtsi"
+#include "k3-am65-iot2050-common-pg2.dtsi"
 
 / {
 	compatible = "siemens,iot2050-advanced-m2", "ti,am654";
@@ -78,3 +78,21 @@ &main_pmx0_m2_config_pins_default
 		&main_pmx1_m2_config_pins_default
 	>;
 };
+
+&serdes0 {
+	assigned-clocks = <&k3_clks 153 4>, <&serdes0 AM654_SERDES_CMU_REFCLK>;
+	assigned-clock-parents = <&k3_clks 153 8>, <&k3_clks 153 4>;
+};
+
+&dwc3_0 {
+	assigned-clock-parents = <&k3_clks 151 4>,	/* set REF_CLK to 20MHz i.e. PER0_PLL/48 */
+				<&k3_clks 151 9>;	/* set PIPE3_TXB_CLK to CLK_12M_RC/256 (for HS only) */
+	/delete-property/ phys;
+	/delete-property/ phy-names;
+};
+
+&usb0 {
+	maximum-speed = "high-speed";
+	/delete-property/ snps,dis-u1-entry-quirk;
+	/delete-property/ snps,dis-u2-entry-quirk;
+};
-- 
2.25.1

